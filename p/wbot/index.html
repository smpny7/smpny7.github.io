<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Discord用 Bot です。大人数サーバーで何かしら返事をくれます。"><title>草bot (wbot) の開発談</title><link rel=canonical href=https://coalabo.net/p/wbot/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="草bot (wbot) の開発談"><meta property="og:description" content="Discord用 Bot です。大人数サーバーで何かしら返事をくれます。"><meta property="og:url" content="https://coalabo.net/p/wbot/"><meta property="og:site_name" content="コアラボ (coalabo.)"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Bot作成"><meta property="article:tag" content="ネタ回"><meta property="article:published_time" content="2021-04-25T00:00:00+09:00"><meta property="article:modified_time" content="2021-04-25T00:00:00+09:00"><meta property="og:image" content="https://coalabo.net/p/wbot/cover.jpg"><meta name=twitter:title content="草bot (wbot) の開発談"><meta name=twitter:description content="Discord用 Bot です。大人数サーバーで何かしら返事をくれます。"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://coalabo.net/p/wbot/cover.jpg"><link rel="shortcut icon" href=/img/favicon.png><style>:root{--accent-color: #694745;--accent-color-darker: #533432;--blockquote-background-color: #F3F0EB;--body-background: #F1EEE5;--body-text-color: #C6BABA;--card-background: #F8F6F3;--card-border-radius: 20px;--card-separator-color: #C6BABA;--card-text-color-main: #533432;--card-text-color-secondary: #A08381;--card-text-color-tertiary: #A08381;--code-background-color: #EEE3E2;--code-text-color: #694745;--table-border-color: #EEE3E2;--tr-even-background-color: #F5F1EC}.article-content h1,.article-content h2,.article-content h3,.article-content h4,.article-content h5,.article-content h6{margin-top:50px}.article-title{letter-spacing:2px;line-height:2.8rem;margin-bottom:10px}.article-subtitle{font-size:1.4rem;letter-spacing:1px}.site-description{font-size:1.4rem!important;line-height:2.2rem}.article-content .gallery figure{margin:0 40px}@media(max-width:812px){.article-content .gallery figure{margin:0 10px}}.article-content .gallery figure a img{border-radius:15px}@media(max-width:812px){.article-content .gallery figure a img{border-radius:5px}}.article-content code{padding:2px 8px}.article-content figure figcaption{letter-spacing:1px}.article-content blockquote{padding:2px calc(var(--card-padding) - var(--blockquote-border-size))}@media(max-width:812px){.menu{border-radius:15px;margin:auto 15px}}.powerby{display:none}.highlight{padding:0 30px}@media(max-width:812px){.highlight{padding:0 10px}}.chroma{border-radius:15px}@media(max-width:812px){.chroma{border-radius:10px}}[data-scheme=light] .chroma{background-color:#343434;color:var(--body-text-color)}[data-scheme=light] .chroma .p,[data-scheme=light] .chroma .nb,[data-scheme=light] .chroma .nv{color:var(--body-text-color)}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-7JJHEMJ2DC"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-7JJHEMJ2DC');</script></head><body><script>(function(){const colorSchemeKey='StackColorScheme';localStorage.setItem(colorSchemeKey,"light");})();</script><script>(function(){const colorSchemeKey='StackColorScheme';const colorSchemeItem=localStorage.getItem(colorSchemeKey);const supportDarkMode=window.matchMedia('(prefers-color-scheme: dark)').matches===true;if(colorSchemeItem=='dark'||colorSchemeItem==='auto'&&supportDarkMode){document.body.dataset.scheme='dark';}else{document.body.dataset.scheme='light';}})();</script><div class="container main-container flex on-phone--column extended article-page with-toolbar"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=メニューを開く・閉じる>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avator.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></figure><h1 class=site-name><a href=https://coalabo.net>コアラボ (coalabo.)</a></h1><h2 class=site-description>プログラミングで、今まで経験してきたことをブログにしてます</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>ホーム</span></a></li><li><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>ブログを書いている人</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>記事一覧</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>記事を探す</span></a></li></ol></aside><main class="main full-width"><div id=article-toolbar><a href=https://coalabo.net class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/wbot/><img src=/p/wbot/cover_hub8c1acb45d2236871445ffc5c0753e18_55702_800x0_resize_q75_box.jpg srcset="/p/wbot/cover_hub8c1acb45d2236871445ffc5c0753e18_55702_800x0_resize_q75_box.jpg 800w, /p/wbot/cover_hub8c1acb45d2236871445ffc5c0753e18_55702_1600x0_resize_q75_box.jpg 1600w" width=800 height=448 loading=lazy alt="Featured image of post 草bot (wbot) の開発談"></a></div><div class=article-details><header class=article-category><a href=/categories/node.js/ style=background-color:#71bc52;color:#fff>Node.js</a>
<a href=/categories/javascript/ style=background-color:#fdd83c;color:#fff>JavaScript</a></header><h2 class=article-title><a href=/p/wbot/>草bot (wbot) の開発談</a></h2><h3 class=article-subtitle>Discord用 Bot です。大人数サーバーで何かしら返事をくれます。</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Apr 25, 2021</time></footer></div></header><section class=article-content><h2 id=察してくださいネタ回です>察してください、ネタ回です</h2><p>Molly fantasy って実在したんですね。</p><p>今回は、友人十数名が入ったDiscordサーバーがあるのですが、
そのサーバー用の Bot を作った、という箸休め回です。</p><p>この Bot は、みんなが登録したキーワードを打つと対応した語録を発言してくれます。</p><h2 id=なんか盛り上がってつくることになった>なんか盛り上がって、つくることになった</h2><p>草Botくん、「草」という文字が入っていると、「草」と返してくれることからこの名前がついたんです。</p><p><figure style=flex-grow:593;flex-basis:1424px><a href=/p/wbot/image_1.jpg data-size=801x135><img src=/p/wbot/image_1.jpg srcset="/p/wbot/image_1_hua3bf971103680b20a1b666a9fc2d9a8e_4219_480x0_resize_q75_box.jpg 480w, /p/wbot/image_1_hua3bf971103680b20a1b666a9fc2d9a8e_4219_1024x0_resize_q75_box.jpg 1024w" width=801 height=135 loading=lazy alt=草Botくん></a><figcaption>草Botくん</figcaption></figure></p><p>実はこの草Bot、今はおもちゃにされています。</p><p>もはやBotの表示名も変えられてますw</p><h2 id=敗因-誰でもプルリクok自動デプロイ仕様にしてしまった>敗因: 誰でもプルリクOK＆自動デプロイ仕様にしてしまった</h2><p>最初は「草」と返してくれる Bot だったのですが、サーバーメンバーがこの Bot にどんどん単語を登録していきました。
ただ、そのセンスがかなり良すぎるので、本来の目的が語録に変わって私も大満足です(笑)</p><p>せっかくなので、自分のお気に入り語録を紹介しましょう。</p><hr><p>これ何だかわかりますか？</p><p><figure style=flex-grow:445;flex-basis:1068px><a href=/p/wbot/image_2.jpg data-size=801x180><img src=/p/wbot/image_2.jpg srcset="/p/wbot/image_2_hu7a9c175328f5b7d4755e767439989923_8444_480x0_resize_q75_box.jpg 480w, /p/wbot/image_2_hu7a9c175328f5b7d4755e767439989923_8444_1024x0_resize_q75_box.jpg 1024w" width=801 height=180 loading=lazy alt="お気に入り語録 その1"></a><figcaption>お気に入り語録 その1</figcaption></figure></p><p>↑ これをみてピンときた人はさすがですね ！</p><hr><p><figure style=flex-grow:447;flex-basis:1073px><a href=/p/wbot/image_3.jpg data-size=801x179><img src=/p/wbot/image_3.jpg srcset="/p/wbot/image_3_hucc9b73f89db2386e0e79142d46a04e8c_12036_480x0_resize_q75_box.jpg 480w, /p/wbot/image_3_hucc9b73f89db2386e0e79142d46a04e8c_12036_1024x0_resize_q75_box.jpg 1024w" width=801 height=179 loading=lazy alt=実はこれ></a><figcaption>実はこれ</figcaption></figure></p><p>これですね！いつものやつです。</p><p>実は以前、みんなで Raspberry Pi OS をセットアップしてた時ですが、
日本語化がうまくいかず、文字化けで何も見えない現象が発生してしまいました。</p><p>唯一文字化けしていても意味がわかった文面が上の文字列で、</p><blockquote><p>伏字にしているのに、隠せれてないwwww</p></blockquote><p>という経緯で追加されました(笑)</p><hr><p>もう一つのお気に入りはこれです。</p><p><figure style=flex-grow:419;flex-basis:1006px><a href=/p/wbot/image_4.jpg data-size=801x191><img src=/p/wbot/image_4.jpg srcset="/p/wbot/image_4_hu481bc9f7a64d92da7e96f4cf74784a11_7355_480x0_resize_q75_box.jpg 480w, /p/wbot/image_4_hu481bc9f7a64d92da7e96f4cf74784a11_7355_1024x0_resize_q75_box.jpg 1024w" width=801 height=191 loading=lazy alt=「腹痛」に反応します></a><figcaption>「腹痛」に反応します</figcaption></figure></p><p>「腹痛」という単語を聞くと、よくわからない係数を測ってくれ、それに応じてアナウンスが流れます。</p><blockquote><p>元ネタはこちら <a class=link href=https://dic.nicovideo.jp/a/%E3%83%89%E3%83%9F%E3%83%8D%E3%83%BC%E3%82%BF%E3%83%BC%28psycho-pass%29 target=_blank rel=noopener>ニコニコ大百科（ドミネーター）</a></p></blockquote><p>しかもこれは、例のよくわからない係数（乱数）に応じてメッセージが変わります。</p><h2 id=今回の技術的なコト>今回の技術的なコト</h2><p>Node.js で作りましたが、Bot はすぐできるので記事にするほどでもないかと思います。</p><p>詳しくは以下のドキュメントをどうぞ！</p><blockquote><p><strong>Discord.js</strong> <a class=link href=https://discord.js.org target=_blank rel=noopener>https://discord.js.org</a></p></blockquote><p>今回、この Bot は <a class=link href=https://jp.heroku.com/home target=_blank rel=noopener>Heroku</a>にデプロイしているので、こちらの知見を共有したいと思います。</p><p>Herokuでは、GitHubリポジトリとHerokuAppを連携させることができます。連携しておくと、
GitHubのmainブランチにプッシュされた時に Webhook が飛ばされ Heroku に自動でデプロイされるのでとても便利です。</p><p>ただ今回、気をつける点が2つありました。</p><ul><li>Procfile を作成すること</li><li>プロセスタイプを worker に設定すること</li></ul><p>この2つを共有して、本記事の締めにしたいと思います。</p><h2 id=procfile-を作成すること>Procfile を作成すること</h2><p>Procfile とは、デプロイ時にどのようなコマンドで run（開始）するかを記述したものです。</p><p><strong>Procfile | Heroku Dev Center</strong> には以下のような記述があります。</p><blockquote><p>Herokuによりサポートされているほとんどの言語で書かれたアプリをデプロイするのに、Procfileは必要はありません。</p></blockquote><blockquote><p>プラットフォームが使われている言語を自動的に検知し、アプリケーションサーバーを起動するために、デフォルトのwebプロセスタイプを作成してくれます。</p></blockquote><p>しかし自動的に検知してくれなかったのか、私の環境では実行されなかったので <code>Procfile</code> を作成しました。</p><p>書き方は以下の通りです。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=o>(</span>processType<span class=o>)</span> : <span class=o>(</span><span class=nb>command</span><span class=o>)</span>
</code></pre></div><p>今回の場合、以下の記述が必要です。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>worker: node index.js
</code></pre></div><p><code>Procfile</code> はアプリのルートディレクトリに設置する必要があります。</p><h2 id=dyno-を-worker-に設定すること>dyno を worker に設定すること</h2><p>もう1つ、今回 Heroku 独特のプロセス処理の種類である <code>dyno</code> をデフォルトから変更する必要がありました。</p><p>dyno には <code>web</code> , <code>worker</code> , <code>one-off</code> の3種類があります。</p><table><thead><tr><th>種類</th><th>機能</th></tr></thead><tbody><tr><td>Web</td><td>ルーターから HTTP トラフィックを受信し、通常は Web サーバーを実行します。</td></tr><tr><td>Worker</td><td>バックグラウンドジョブ、キューイングシステム、時間指定のあるジョブなどを実行します。</td></tr><tr><td>One-off</td><td>管理タスクの処理（REPL シェルを実行してデータベースの移行や一時的なバックグラウンド作業を行う場合など）に使用します。</td></tr></tbody></table><p>今回、Discord Bot では常にチャンネルのテキストを取得する必要があるため、<code>worker</code> に設定する必要があります。</p><p>HerokuCLI を導入している場合は、以下のコマンドで <code>worker</code> に切り替えることができます。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>heroku ps:scale <span class=nv>worker</span><span class=o>=</span><span class=m>1</span>
</code></pre></div><h2 id=さいごに>さいごに</h2><p>なんだかんだ、やっぱりBotがいてくれると楽しいですよね。</p><p>次はもっと有用な Bot を作りたいと思います (笑)</p></section><footer class=article-footer><section class=article-tags><a href=/tags/bot%E4%BD%9C%E6%88%90/>Bot作成</a>
<a href=/tags/%E3%83%8D%E3%82%BF%E5%9B%9E/>ネタ回</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>関連するコンテンツ</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/p/jokura-web/><div class=article-image><img src=/p/jokura-web/cover.559e1c92a028ff6a97a0fdb7e7c7ec00_hu009098f9a09b5c87310a26959658631a_93318_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy data-key=jokura-web data-hash="md5-VZ4ckqAo/2qXoP2358fsAA=="></div><div class=article-details><h2 class=article-title>Minecraftサーバーのリモート制御サイトを制作したお話（情クラ！）</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2020 -
2021 コアラボ (coalabo.)</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.3.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const customFont=document.createElement('link');customFont.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";customFont.type="text/css";customFont.rel="stylesheet";document.head.appendChild(customFont);}());</script></body></html>